cmake_minimum_required(VERSION 3.24)

include("${CMAKE_CURRENT_LIST_DIR}/../conan_support.cmake")

project(TestConanSupport)

function(expect_true result)
    if(NOT result)
        message(SEND_ERROR "Expected TRUE, but result is ${result}")
    endif()
endfunction()

function(expect_false result)
    if(result)
        message(SEND_ERROR "Expected FALSE, but result is ${result}")
    endif()
endfunction()

function(expect_equal value1 value2)
    if(NOT value1 STREQUAL value2)
        message(SEND_ERROR "Value is \"${value1}\" but expected \"${value2}\"")
    endif()
endfunction()

function(test_conan_version_parse_one_digit)
    conan_version_parse(result conan_version "1")
    expect_false("${result}")
endfunction()
test_conan_version_parse_one_digit()

function(test_conan_version_parse_two_digits)
    conan_version_parse(result conan_version "1.2")
    expect_false("${result}")
endfunction()
test_conan_version_parse_two_digits()

function(test_conan_version_parse_three_digits)
    conan_version_parse(result conan_version "1.2.3")
    expect_true("${result}")
    expect_equal("${conan_version}" "1.2.3")
endfunction()
test_conan_version_parse_three_digits()

function(test_conan_version_parse_four_digits)
    conan_version_parse(result conan_version "1.2.3.4")
    expect_true("${result}")
    expect_equal(${conan_version} "1.2.3")
endfunction()
test_conan_version_parse_four_digits()

function(test_conan_version_parse_beta_release)
    conan_version_parse(result conan_version "2.0.0-beta10")
    expect_true(${result})
    expect_equal("${conan_version}" "2.0.0")
endfunction()
test_conan_version_parse_beta_release()

function(conan_version_check_major_too_old)
    conan_version_check(result MINIMUM 2.0.0 CURRENT 1.0.0)
    expect_false("${result}")
endfunction()
conan_version_check_major_too_old()

function(conan_version_check_minor_too_old)
    conan_version_check(result MINIMUM 2.1.0 CURRENT 2.0.0)
    expect_false("${result}")
endfunction()
conan_version_check_minor_too_old()

function(conan_version_check_patch_too_old)
    conan_version_check(result MINIMUM 2.0.1 CURRENT 2.0.0)
    expect_false("${result}")
endfunction()
conan_version_check_patch_too_old()

function(conan_version_check_major_new_enough)
    conan_version_check(result MINIMUM 1.0.0 CURRENT 2.0.0)
    expect_true("${result}")
endfunction()
conan_version_check_major_new_enough()

function(conan_version_check_minor_new_enough)
    conan_version_check(result MINIMUM 2.0.0 CURRENT 2.1.0)
    expect_true("${result}")
endfunction()
conan_version_check_minor_new_enough()

function(conan_version_check_patch_new_enough)
    conan_version_check(result MINIMUM 2.0.0 CURRENT 2.0.1)
    expect_true("${result}")
endfunction()
conan_version_check_patch_new_enough()
